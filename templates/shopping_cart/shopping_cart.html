{% extends 'base/base.html' %}
{% load dict %}
{% load static %}
{% block page_content %}
    {% if not jewelries_by_quantity_and_size %}
        Your Shopping Bag is Empty
    {% else %}
        Shopping Bag
        <table class="shopping_cart">
            {#        <thead class="nth-row">#}
            {#        <tr>#}
            {#            <th colspan="6">Shopping Bag</th>#}
            {#        </tr>#}
            {#        </thead>#}
            {% for jewelry, details in jewelries_by_quantity_and_size.items %}
                <thead class="nth-row">
                <tr>
                    <th>Jewelry</th>
                    <th>Metals</th>
                    <th>Stones</th>
                    <th>Size</th>
                    <th>Quantity</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <a href="{% url 'display_jewelry_details' jewelry.pk %}" target="_blank">
                            <img width="250" height="250" src="{{ jewelry.first_image_url }}" alt="image1"
                                 title="{{ jewelry.title }}">
                        </a>
                    </td>
                    <td id="metals-content">
                        <ul>
                            {% for metal, carat in details.metal_info_dict.items %}
                                {% if carat %}
                                    <li>{{ carat }} {{ metal }} </li>
                                {% else %}
                                    <li>{{ metal }}</li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </td>
                    <td id="stones-content">
                        <ul>
                            {% for stone_type, stone_color in details.stone_info_dict.items %}
                                <li>{{ stone_type }} {{ stone_color }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>
                        {{ details.size }}
                    </td>
                    <td>
                        <form action="{% url 'update_shopping_cart' jewelry.pk %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="jewelry_id" value="{{ jewelry.pk }}">
                            <input type="number" name="quantity" value="{{ details.quantity }}"
                                   min={{ details.min_quantity }} max={{ details.max_quantity }}>
                            <br>
                            <button type="submit" name="update_quantity" class="button hover filled_blue">
                                <i class="fa-solid fa-pencil"></i> UPDATE
                            </button>
                        </form>
                    </td>
                    <td>
                        {{ details.jewelry_total_price }}
                    </td>
                </tr>
                </tbody>
            {% endfor %}
            <tfoot>
            <tr>
                <td id="footer-left" colspan="4">Total:</td>
                <td colspan="2">{{ total_price }}</td>
            </tr>
            </tfoot>
        </table>

<div>
        {% if request.user.is_authenticated %}
            <form action="{% url 'complete_order' request.user.pk %}" method="get">
                <button class="button hover filled_green">
                    <i class="fa-regular fa-credit-card"></i> CHECKOUT
                </button>
                {% csrf_token %}
            </form>
        {% else %}
            <a href="{% url 'login_user' %}?next={{ request.path }}" class="button hover filled_green">
                <i class="fa-regular fa-credit-card"></i> CHECKOUT</a>
        {% endif %}
</div>

<div>
        {% for jewelry in last_viewed_jewelries %}
            <a href="{% url 'display_jewelry_details' jewelry.pk %}">
                <img width="150" height="150" src="{{ jewelry.first_image_url }}" alt="image1">
            </a>
        {% endfor %}
</div>
    {% endif %}
{% endblock %}



{#{% extends 'base/base.html' %}#}
{#{% load dict %}#}
{#{% load static %}#}
{#{% block page_content %}#}
{#    {% for jewelry, details in jewelries_by_quantities.items %}#}
{#        <li>#}
{#            <img width="150" height="150" src="{{ jewelry.first_image_url }}" alt="image1">#}
{#        </li>#}
{#        <li>#}
{#            <a href="{% url 'display_jewelry_details' jewelry.pk %}?page={{ page_obj.number }}">#}
{#                <button>JEWELRY DETAILS</button>#}
{#            </a>#}
{#        </li>#}
{#        <li>#}
{#            PRICE: {{ details.jewelry_total_price }}#}
{#        </li>#}
{#        <li>#}
{#            <form action="{% url 'update_shopping_cart' jewelry.pk %}" method="post">#}
{#                {% csrf_token %}#}
{#                <input type="hidden" name="jewelry_id" value="{{ jewelry.pk }}">#}
{#                <input type="number" name="quantity" value="{{ details.quantity }}"#}
{#                       min={{ details.min_quantity }} max={{ details.max_quantity }}>#}
{#                <button type="submit" name="update_quantity">UPDATE QUANTITY</button>#}
{#            </form>#}
{#        </li>#}
{##}
{#    {% endfor %}#}
{#    <div>#}
{#        Total Price#}
{#        {{ total_price }}#}
{#    </div>#}
{#    <div>#}
{#        {% if request.user.is_authenticated %}#}
{#            <form action="{% url 'complete_order' request.user.pk %}" method="get">#}
{#                <button>COMPLETE ORDER</button>#}
{#                {% csrf_token %}#}
{#            </form>#}
{#        {% else %}#}
{##}
{#            <a href="{% url 'login_user' %}?next={{ request.path }}">Login to Complete Order</a>#}
{##}
{#        {% endif %}#}
{#    </div>#}
{#    {% for jewelry in last_viewed_jewelries %}#}
{#        <a href="{% url 'display_jewelry_details' jewelry.pk %}">#}
{#            <img width="150" height="150" src="{{ jewelry.first_image_url }}" alt="image1">#}
{#        </a>#}
{#    {% endfor %}#}
{#{% endblock %}#}
